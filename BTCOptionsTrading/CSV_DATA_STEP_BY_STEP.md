# CSV 数据查看 - 分步指南

## 问题
"在历史数据分析页面下，点击合约分析，下拉框里还是没有数据"

## 原因
你在看错了标签页。应该使用"CSV数据分析"标签页，而不是"合约分析"标签页。

## 解决方案 - 5 步

### 步骤 1: 启动后端 API
```bash
cd BTCOptionsTrading/backend
python -m uvicorn src.api.app:app --reload --host 0.0.0.0 --port 8000
```

**预期结果**: 看到类似的输出
```
INFO:     Uvicorn running on http://0.0.0.0:8000
```

### 步骤 2: 打开前端应用
- 在浏览器中访问 `http://localhost:3000`
- 应该看到应用的主页面

### 步骤 3: 导航到历史数据分析
- 在左侧菜单中找到"历史数据分析"
- 点击它

**预期结果**: 看到历史数据分析页面

### 步骤 4: 找到标签页
你会看到 4 个标签页：
```
┌─────────────────────────────────────────────────────┐
│ [数据概览] [合约分析] [CSV数据分析] [数据质量]      │
└─────────────────────────────────────────────────────┘
```

### 步骤 5: 点击"CSV数据分析"标签页
- 点击第三个标签页 **"CSV数据分析"**
- 不要点击"合约分析"

**预期结果**: 
- 看到"选择CSV合约"部分
- 下拉菜单显示 1300 个合约
- 例如：`BTC-13MAR26-100000-C (执行价: $100,000)`

## 查看合约数据

### 步骤 6: 选择一个合约
- 点击下拉菜单
- 选择任意一个合约（例如 `BTC-13MAR26-100000-C`）

**预期结果**: 
- 下拉菜单显示选中的合约
- 页面开始加载数据

### 步骤 7: 查看合约信息
向下滚动，你会看到：

**合约信息卡片**
```
合约名称: BTC-13MAR26-100000-C
标的资产: BTC
执行价: $100,000
期权类型: 看涨 (Call)
到期日: 2026年3月13日
数据点数: 4
平均价格: 0.09585 BTC
数据时间范围: 2026年2月20日 ~ 2026年2月23日
```

### 步骤 8: 查看价格曲线
继续向下滚动，你会看到：

**价格曲线图**
- X 轴：日期
- Y 轴：价格
- 三条线：标记价格、买价、卖价

**隐含波动率图**
- 显示波动率随时间的变化

**成交量图**
- 显示成交量随时间的变化

## 验证数据

### 方法 1: 浏览器开发者工具
1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签页
3. 运行以下命令：

```javascript
// 测试 CSV API
fetch('/api/csv/contracts?underlying=BTC')
  .then(r => r.json())
  .then(d => {
    console.log('✓ CSV API 工作正常')
    console.log('合约数:', d.contracts.length)
    console.log('第一个合约:', d.contracts[0].instrument_name)
  })
  .catch(e => console.error('✗ 错误:', e))
```

**预期输出**:
```
✓ CSV API 工作正常
合约数: 1300
第一个合约: BTC-13MAR26-100000-C
```

### 方法 2: 命令行
在另一个终端运行：

```bash
# 测试 CSV API
curl http://localhost:8000/api/csv/contracts?underlying=BTC | jq '.contracts | length'
```

**预期输出**:
```
1300
```

## 常见问题

### Q: 为什么"合约分析"显示 0 个合约？
A: 因为"合约分析"使用的是数据库 API，而不是 CSV API。如果数据库中没有数据，就会显示 0 个。

**解决方案**: 使用"CSV数据分析"标签页

### Q: 为什么下拉菜单还是显示 0 个合约？
A: 可能是以下原因：
1. 后端 API 未启动
2. 前端缓存问题
3. 网络连接问题

**解决方案**:
1. 确保后端 API 正在运行
2. 清除浏览器缓存（Ctrl+Shift+Delete）
3. 刷新页面

### Q: 为什么看不到图表？
A: 可能是以下原因：
1. 合约数据还在加载
2. 合约没有价格数据
3. 浏览器不支持图表库

**解决方案**:
1. 等待数据加载完成
2. 选择另一个合约
3. 使用最新版本的浏览器

## 数据说明

### CSV 数据来源
- **位置**: `backend/data/downloads/`
- **文件数**: 5 个 CSV 文件
- **记录数**: 5034 条
- **合约数**: 1300 个

### 数据内容
每个合约包含以下信息：
- 合约名称（例如：BTC-13MAR26-100000-C）
- 标的资产（BTC）
- 执行价（例如：$100,000）
- 期权类型（Call 或 Put）
- 到期日期
- 价格历史（标记价格、买价、卖价）
- 隐含波动率
- 成交量

### 时间范围
- **开始**: 2026年2月20日
- **结束**: 2026年2月23日

## 下一步

1. ✓ 使用"CSV数据分析"标签页查看数据
2. ✓ 选择不同的合约并分析价格曲线
3. ✓ 比较不同合约的波动率和成交量
4. ✓ 如果需要在"合约分析"中显示 CSV 数据，请联系开发团队

## 文件位置

- **后端 API**: `backend/src/api/routes/csv_data.py`
- **前端客户端**: `frontend/src/api/csv.ts`
- **前端组件**: `frontend/src/components/tabs/HistoricalDataTab.tsx`
- **CSV 数据**: `backend/data/downloads/`

---

**最后更新**: 2026年2月23日
