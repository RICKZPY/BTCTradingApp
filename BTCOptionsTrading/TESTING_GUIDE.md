# 测试智能策略保存功能

## 快速测试步骤

### 1. 启动后端服务器
```bash
cd BTCOptionsTrading/backend
python run_api.py
```

### 2. 启动前端开发服务器
```bash
cd BTCOptionsTrading/frontend
npm run dev
```

### 3. 在浏览器中测试

1. 打开浏览器访问前端地址（通常是 http://localhost:5173）
2. 进入 "策略" 标签页
3. 点击 "🧠 智能构建" 按钮

#### 测试场景 A: 使用预定义模板
1. 在 "快速开始 - 使用模板" 区域
2. 点击任意模板（如 "OTM跨式策略"）
3. 观察下方表单自动填充：
   - 策略名称和描述已填充
   - 策略类型已选择
   - 策略腿已配置（跨式策略会显示2个腿：看涨和看跌）
4. 可以调整任何参数（到期日、行权价、数量等）
5. 点击 "构建策略" 按钮
6. 应该看到 "策略构建并保存成功！" 提示
7. 关闭智能构建器
8. 检查 "我的策略" 列表，新策略应该出现在列表中

#### 测试场景 B: 自定义策略
1. 在 "自定义策略" 区域
2. 填写策略名称（如 "测试策略"）
3. 选择策略类型
4. 配置策略腿：
   - 选择期权类型（看涨/看跌）
   - 选择操作（买入/卖出）
   - 设置数量
   - 选择到期日（如 "一周"）
   - 选择行权价（如 "平值"）
5. 点击 "构建策略" 按钮
6. 应该看到 "策略构建并保存成功！" 提示
7. 关闭智能构建器
8. 检查 "我的策略" 列表，新策略应该出现在列表中

### 4. 验证数据库

可以运行后端测试脚本验证数据库中的策略：

```bash
cd BTCOptionsTrading/backend
python test_smart_strategy_save.py
```

这会显示：
- 策略构建过程
- 保存到数据库的结果
- 数据库中所有策略的列表

## 预期结果

✓ 策略构建成功
✓ 显示成功提示消息
✓ 策略出现在 "我的策略" 列表中
✓ 可以点击策略查看详情
✓ 可以编辑、复制或删除策略

## 故障排除

### 问题：策略没有出现在列表中

1. 检查浏览器控制台是否有错误
2. 检查后端日志是否有错误
3. 确认后端API正常运行（访问 http://localhost:8000/docs）
4. 尝试刷新页面

### 问题：TypeScript 编译错误

如果看到 "Cannot find module" 错误：
1. 重启前端开发服务器
2. 清除 node_modules 并重新安装：
   ```bash
   rm -rf node_modules
   npm install
   ```
3. 这个错误不影响实际运行，可以暂时忽略

### 问题：API 连接失败

1. 确认后端服务器正在运行
2. 检查 `.env` 文件中的 API 配置
3. 确认 Deribit API 密钥配置正确（测试网）

## 相关文档

- [智能策略使用指南](./SMART_STRATEGY_README.md)
- [定时交易使用指南](./SCHEDULED_TRADING_README.md)
- [修复总结](./SMART_STRATEGY_FIX_SUMMARY.md)
